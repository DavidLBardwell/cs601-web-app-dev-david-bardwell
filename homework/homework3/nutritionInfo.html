<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title>NutritionInfo - David Bardwell homework 3</title>
        <link type="text/css" href="css/ui-lightness/jquery-ui-1.8.23.custom.css" 
                rel="stylesheet" />
        <script type="text/javascript" 
                src="js/jquery-1.8.0.min.js"></script>
        <script type="text/javascript" 
                src="js/jquery-ui-1.8.23.custom.min.js"></script>
                
        <script type="text/javascript">
            // array of JSON objects
            var itemList = [];
             
            $(function() {
                // disable the input until data is loaded
                $('#target').attr("disabled", "disabled");
                // make the ajax request
                $.ajax({
                    url : "cgi-bin/getData.php",
                    data : {url : "http://kalathur.com/food/calories.xml"},
                    complete : function(xhr, result) {
                        if (result !== "success")
                            return;
                        var response = xhr.responseXML;
                        // for each <song> element
                        $(response).find("item").each (function() {
                            var name = $(this).find("name").text();
                            var size = $(this).find("size").text();
                            var fat = $(this).find("fat").text();
                            var item = 
                                {label : name, 
                                 value : name,
                                 data : {name : name, size : size, 
                                        fat : fat}};
                           itemList.push(item); 
                        });
                    }
                });
                // enable the input
                $('#target').removeAttr("disabled");
             
                // setup autocomplete options
                var options = {
                    source : selectEntries,
                    select : makeSelection
                };
                $('#target').autocomplete(options);
            });
            
            // request.term -- user entry
            // callback -- to return array of values
            function selectEntries (request, callback) {
                //console.log(request.term);
                var result = [];
                // filter the data for matching entries
                result = $.grep(itemList,
                    function(value, index) {
                        return  (value.label.toLowerCase().indexOf(
                            request.term.toLowerCase()) === 0);
                    });
               // return the results
               callback(result);
            }
            // when a selection is made
            function makeSelection(event, ui) {
                $('#name').val(ui.item.data.name);
                $('#size').val(ui.item.data.size);
                $('#fat').val(ui.item.data.fat);
            }
        </script>
    </head>
    
    <body>
        <h2>JQuery Nutrition Autocomplete</h2>
        <div class="ui-widget">
            <label for="target">Menu Item Name: </label>
            <input id="target" size="60"/>
            <p></p>
            <label for="name">Menu Item Name: </label>
            <output id="name"></output>
            <p></p>
            <label for="size">Serving Size: </label>
            <output id="size"></output>
            <p></p>
            <label for="fat">Calories: </label>
            <output id="fat"></output>            
        </div>
    </body>
</html>
